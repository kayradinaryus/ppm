// features/advanced-inviter.js - v4.6 Nihai Stil Güncellemesi

(async function() {
    'use strict';

    // Öncelikle bu özelliğin ayarlardan aktif edilip edilmediğini kontrol edelim.
    const settings = await chrome.storage.sync.get({ 'advanced_inviter_enable': false });
    if (!settings.advanced_inviter_enable) {
        return;
    }

    // === SABİTLER VE YARDIMCI FONKSİYONLAR ===
    const SEND_DELAY_SECONDS = 3;
    const TICKET_PRICES = { 0: "0,10", 1: "5", 2: "7", 3: "8", 4: "9", 5: "11", 6: "13", 7: "15", 8: "20", 9: "25", 10: "30", 11: "40", 12: "45", 13: "50", 14: "55", 15: "60", 16: "65", 17: "70", 18: "75", 19: "80", 20: "90", 21: "100", 22: "105", 23: "110", 24: "115", 25: "120", 26: "125" };
    const PROCESS_STOP_KEY = 'popmundoProcessStopped';
    const CITY_MAPPINGS = {'Amsterdam': 'AMS', 'Ankara': 'ANK', 'Antalya': 'ANT', 'Buenos Aires': 'BA', 'Baku': 'BAK', 'Barcelona': 'BAR', 'Belgrade': 'BEL', 'Berlin': 'BER', 'Brussels': 'BRU', 'Bucharest': 'BUC', 'Budapest': 'BUD', 'Chicago': 'CHI', 'Copenhagen': 'COP', 'Dubrovnik': 'DUB', 'Glasgow': 'GL', 'Helsinki': 'HEL', 'Istanbul': 'IST', 'Izmir': 'IZM', 'Jakarta': 'JAK', 'Johannesburg': 'JOH', 'Kyiv': 'KYI', 'Los Angeles': 'LA', 'London': 'LON', 'Madrid': 'MAD', 'Manila': 'MAN', 'Melbourne': 'MEL', 'Mexico City': 'MEX', 'Milan': 'MIL', 'Montreal': 'MON', 'Moscow': 'MOS', 'Nashville': 'NAS', 'New York': 'NY', 'Paris': 'PAR', 'Porto': 'POR', 'Rio de Janeiro': 'RIO', 'Rome': 'ROM', 'São Paulo': 'SAO', 'Sarajevo': 'SAR', 'Seattle': 'SEA', 'Shanghai': 'SHA', 'Singapore': 'SIN', 'Sofia': 'SOF', 'Stockholm': 'STO', 'Tallinn': 'TAL', 'Tokyo': 'TOK', 'Toronto': 'TOR', 'Tromsø': 'TRO', 'Vilnius': 'VIL', 'Warsaw': 'WAR'};
    const baseStyle = `font-family:"Lucida Grande", Verdana, sans-serif; font-size:10px; color:#111111; font-weight:400; line-height:normal; text-transform:none;`;
    const buttonStyle = `${baseStyle} color:#ffffff; padding:5px 10px; margin:0; cursor:pointer; display:inline-flex; align-items:center; justify-content:center; min-width:32px; background-color:#33647D; border:1px solid #2a5265; border-radius:4px; transition:all 0.2s;`;
    const ICONS = {
        DELETE: `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg>`,
        SAVE: `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2H2.5a.5.5 0 0 1 0 1H2z"/></svg>`,
        ADD: `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>`,
        UPLOAD: `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/></svg>`,
        SEND: `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="margin-right: 5px;"><path d="M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"/></svg>`,
        STOP: `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M.293.293a1 1 0 0 1 1.414 0L8 6.586 14.293.293a1 1 0 1 1 1.414 1.414L9.414 8l6.293 6.293a1 1 0 0 1-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L6.586 8 .293 1.707a1 1 0 0 1 0-1.414z"/></svg>`
    };
    const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));
    function isProcessStopped() { return localStorage.getItem(PROCESS_STOP_KEY) === 'true'; }
    function stopProcess() { localStorage.setItem(PROCESS_STOP_KEY, 'true'); console.log('İŞLEM DURDURULDU!'); }
    function startProcess() { localStorage.removeItem(PROCESS_STOP_KEY); console.log('İşlem başlatıldı.'); }
    class CompanyStorage { constructor() { this.storageKey = 'popmundoMekanlar'; } getCompanies() { return JSON.parse(localStorage.getItem(this.storageKey) || '[]'); } saveCompany(companyName) { const companies = this.getCompanies(); const newCompany = { id: Date.now(), name: companyName, venues: [] }; companies.push(newCompany); localStorage.setItem(this.storageKey, JSON.stringify(companies)); return newCompany.id; } deleteCompany(companyId) { let companies = this.getCompanies(); companies = companies.filter(c => c.id !== companyId); localStorage.setItem(this.storageKey, JSON.stringify(companies)); } saveVenues(companyId, venues) { const companies = this.getCompanies(); const company = companies.find(c => c.id === companyId); if (company) { company.venues = venues; localStorage.setItem(this.storageKey, JSON.stringify(companies)); } } getVenues(companyId) { const company = this.getCompanies().find(c => c.id === parseInt(companyId)); return company ? company.venues : []; } }
    class TourManager { constructor() { this.tourStateKey = 'popmundoTourState'; } storeTourState(tourData, currentIndex, formData) { const state = { tours: tourData, currentIndex: currentIndex, formData: formData, timestamp: Date.now() }; localStorage.setItem(this.tourStateKey, JSON.stringify(state)); } getTourState() { const state = localStorage.getItem(this.tourStateKey); return state ? JSON.parse(state) : null; } clearTourState() { localStorage.removeItem(this.tourStateKey); } async fetchCSV(csvUrl) { let rawUrl = csvUrl; if (csvUrl.includes('github.com') && !csvUrl.includes('raw.githubusercontent.com')) { rawUrl = csvUrl.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/'); } try { const response = await fetch(rawUrl); if (!response.ok) { throw new Error(`Ağ yanıtı başarılı değil: ${response.status} ${response.statusText}`); } const csvText = await response.text(); return new Promise((resolve) => { Papa.parse(csvText, { header: false, complete: (results) => { resolve(results.data); } }); }); } catch (error) { console.error('CSV getirme hatası:', error); throw error; } } convertDate(dateStr, timeStr) { try { if (!dateStr || !timeStr) throw new Error('Geçersiz tarih veya saat'); let day, month, year; if (dateStr.includes('-')) [year, month, day] = dateStr.split('-'); else if (dateStr.includes('.')) [day, month, year] = dateStr.split('.'); else if (dateStr.includes('/')) [day, month, year] = dateStr.split('/'); else throw new Error(`Tanınmayan tarih formatı: ${dateStr}`); let [hour, minute] = timeStr.split(/[:.]/); const formattedDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`; const formattedTime = `${String(hour).padStart(2, '0')}:${String(minute || '00').padStart(2, '0')}`; return { date: formattedDate, time: formattedTime }; } catch (e) { console.error('Tarih dönüştürme hatası:', e); throw e; } } async sendInvite(venueId, date, time, ticketPrice, artistCut, rider) { if (isProcessStopped()) { return false; } try { const form = document.querySelector('form[name="aspnetForm"]'); const [venueSelect, daySelect, hoursSelect, ticketPriceInput, artistCutInput, riderInput, submitButton] = [ form.querySelector('[name*="ddlVenues"]'), form.querySelector('[name*="ddlDay"]'), form.querySelector('[name*="ddlHours"]'), form.querySelector('[name*="txtTicketPrice"]'), form.querySelector('[name*="txtArtistCut"]'), form.querySelector('[name*="txtRider"]'), form.querySelector('[name*="btnInvite"]') ]; if (!form || !submitButton) throw new Error('Davet formu bulunamadı.'); venueSelect.value = venueId; const { year: csvYear, month: csvMonth, day: csvDay } = (([y, m, d]) => ({ year: parseInt(y), month: parseInt(m), day: parseInt(d) }))(date.split('-')); let dateOptionFound = Array.from(daySelect.options).find(opt => { const match = opt.text.match(/(\d{1,2})\.(\d{1,2})\.(\d{4})/); return match && parseInt(match[1]) === csvDay && parseInt(match[2]) === csvMonth && parseInt(match[3]) === csvYear; }); if (!dateOptionFound) { stopProcess(); throw new Error(`Tarih (${date}) listede bulunamadı.`); } dateOptionFound.selected = true; let hourOptionFound = Array.from(hoursSelect.options).find(opt => opt.text.startsWith(time.split(':')[0])); if (!hourOptionFound) { stopProcess(); throw new Error(`Saat (${time}) listede bulunamadı.`); } hourOptionFound.selected = true; ticketPriceInput.value = ticketPrice; if (artistCutInput) artistCutInput.value = artistCut; if (riderInput) riderInput.value = rider; console.log(`Davet hazırlandı. ${SEND_DELAY_SECONDS} saniye içinde gönderilecek...`); for (let i = 0; i < SEND_DELAY_SECONDS * 1000; i += 100) { if (isProcessStopped()) { console.log("Gönderim iptal edildi."); return false; } await sleep(100); } if (isProcessStopped()) { return false; } submitButton.click(); return true; } catch (e) { console.error('Davet gönderme hatası:', e); stopProcess(); throw e; } } async processTour(tour, companyId, serviceLimit, profitShare) { if (isProcessStopped()) { return false; } try { const [dateStr, timeStr, cityName] = tour; if (!cityName || !dateStr || !timeStr) { return false; } const ticketPrice = getPriceByArtistFame(); const dateInfo = this.convertDate(dateStr, timeStr); const cityAbbr = CITY_MAPPINGS[cityName.trim()]; if (!cityAbbr) { throw new Error(`${cityName} için şehir kısaltması bulunamadı.`); } const storage = new CompanyStorage(); const venue = storage.getVenues(companyId).find(v => v.name.toUpperCase().includes(cityAbbr.toUpperCase())); if (!venue) { throw new Error(`${cityName} (${cityAbbr}) için mekan bulunamadı.`); } return await this.sendInvite(venue.id, dateInfo.date, dateInfo.time, ticketPrice, serviceLimit, profitShare); } catch (e) { console.error(`${tour[2]} için işlem hatası:`, e); stopProcess(); return false; } } }
    function getPriceByArtistFame() { try { const fameLink = Array.from(document.querySelectorAll("#ppm-content a")).find(el => el.href.includes("/World/Popmundo.aspx/Help/Scoring/")); const fameLevel = fameLink.title.split("/")[0]; return TICKET_PRICES[fameLevel] || "5"; } catch { return "5"; } }
    async function scrapeVenues() { try { const table = document.getElementById('tablelocales'); if (!table) { return []; } const venues = Array.from(table.querySelectorAll('tr')).slice(1).map(row => { const anchor = row.querySelector('td:first-child a'); if (!anchor) return null; const venueIdMatch = anchor.getAttribute('href').match(/\/(\d+)/); return venueIdMatch ? { id: venueIdMatch[1], name: anchor.textContent.trim() } : null; }).filter(Boolean); return venues; } catch (e) { console.error('Mekan kazıma hatası:', e); return []; } }
    function createUI() { const sideMenu = document.getElementById('ppm-sidemenu'); if (!sideMenu) return null; const box = document.createElement('div'); box.className = 'box'; box.style.marginBottom = '10px'; box.innerHTML = `<h2 style="${baseStyle} margin:0 0 5px 0; padding:5px; border-bottom:1px solid #2a5265; background:#33647D; color:white;">Mekân Yöneticisi</h2><div class="menu"><div style="padding:3px;"><select id="companySelect" style="${baseStyle} width:100%; margin-bottom:4px; padding:2px; border:1px solid #ccc;"></select><div id="newCompanyArea" style="display:none; margin-bottom:4px;"><input type="text" id="companyName" placeholder="Yeni Şirket Adı" style="${baseStyle} width:calc(100% - 40px); padding:3px; border:1px solid #ccc; display:inline-block;"><button id="createCompany" title="Yeni şirket oluştur" style="${buttonStyle}">${ICONS.ADD}</button></div><div style="display:flex; gap:4px;"><button id="deleteCompany" title="Seçili şirketi sil" style="${buttonStyle}; display:none; background:#c82333; border-color:#bd2130;">${ICONS.DELETE}</button><button id="saveVenues" title="Mekânları kaydet" style="${buttonStyle}; display:none;">${ICONS.SAVE}</button></div><div id="status" style="${baseStyle} margin-top:4px; font-size:9px; color:#666;"></div></div></div>`; sideMenu.insertBefore(box, sideMenu.querySelector('.box:last-child')); return { companySelect: box.querySelector('#companySelect'), companyNameInput: box.querySelector('#companyName'), createCompanyBtn: box.querySelector('#createCompany'), saveVenuesBtn: box.querySelector('#saveVenues'), deleteCompanyBtn: box.querySelector('#deleteCompany'), statusDiv: box.querySelector('#status') }; }
    function createInvitePanel() { const panel = document.createElement('div'); panel.className = 'invite-panel'; panel.style.cssText = `background:#AEC8CF; border:0px solid #ccc; border-radius:4px; padding:15px; margin:10px 0; display:none;`; panel.innerHTML = `<h2 style="${baseStyle} margin:-15px -15px 10px -15px; padding:8px 15px; border-bottom:1px solid #ffe6e6; background:#ffe6e6; color:#333; border-radius:4px 4px 0 0;">Otomatik Davet Paneli</h2><div style="margin-bottom:5px; padding:5px; background:#e6ffed; border:1px solid #c3e6cb; border-radius:3px;"><b style="color:#111111;">Otomatik Fiyatlandırma Aktif:</b><span style="color:#333;"> Bilet fiyatı, sanatçınızın şöhretine göre otomatik olarak belirlenecektir.</span></div><div style="margin-bottom:10px; margin-top:10px;"><label style="${baseStyle}">Şirket Seç:</label><select id="invite-company-select" style="width:100%; margin-top:3px; padding:3px;"></select></div><div style="margin-bottom:10px;"><label style="${baseStyle}">CSV Dosya URL'si (Format: Tarih,Saat,Şehir):</label><input type="text" id="csv-url" style="width:100%; margin-top:3px; padding:3px;" placeholder="https://..."></div><div style="display:flex; gap:10px; margin-bottom:15px; align-items:flex-end;"><div style="flex-grow:1;"><label style="${baseStyle}">Kâr Payı (%):</label><input type="number" id="artist-cut" style="width:100%; padding:3px;" value="50"></div><div style="flex-grow:1;"><label style="${baseStyle}">Ekstra Hizmet Limiti (M$):</label><input type="number" id="rider-limit" style="width:100%; padding:3px;" value="333333"></div></div><div style="display:flex; gap:5px; margin-bottom:15px;"><button type="button" id="sendInvites" title="Davetleri Gönder" style="${buttonStyle}; flex-grow:1; background:#28a745; border-color:#218838; color:white;">${ICONS.SEND}</button><button type="button" id="loadTours" title="Turları Yükle" style="${buttonStyle}">${ICONS.UPLOAD}</button><button type="button" id="stopInvites" title="İşlemi Durdur" style="${buttonStyle}; background:#c82333; border-color:#bd2130; color:white;">${ICONS.STOP}</button></div><div id="tourStatus" style="font-size:11px; color:#111111;"></div><div id="progressBar" style="height:10px; background:#eee; margin-top:10px; border-radius:5px; display:none;"><div style="height:100%; background:#b3cbd1; width:0%; border-radius:5px;"></div></div><div id="progressText" style="font-size:9px; color:#666; margin-top:3px;"></div>`; return panel; }
    function attachInvitePanelListeners(panel) { const storage = new CompanyStorage(); const companySelect = panel.querySelector('#invite-company-select'); storage.getCompanies().forEach(c => companySelect.add(new Option(c.name, c.id))); panel.querySelector('#loadTours').addEventListener('click', async () => { const csvUrl = panel.querySelector('#csv-url').value.trim(); const statusDiv = panel.querySelector('#tourStatus'); if (!csvUrl) { alert('Lütfen CSV dosya linkini girin!'); return; } statusDiv.textContent = 'Turlar yükleniyor...'; try { const tours = await window.tourManager.fetchCSV(csvUrl); window.currentTours = tours.filter(t => Array.isArray(t) && t.length >= 3 && t.every(val => val)); statusDiv.textContent = `✅ ${window.currentTours.length} geçerli tur yüklendi.`; } catch (e) { statusDiv.textContent = `Hata: ${e.message}`; } }); panel.querySelector('#sendInvites').addEventListener('click', async () => { if (!window.currentTours || window.currentTours.length === 0) { alert('Önce turları yüklemelisiniz!'); return; } const formData = { companyId: panel.querySelector('#invite-company-select').value, artistCut: panel.querySelector('#artist-cut').value, rider: panel.querySelector('#rider-limit').value }; if (!formData.companyId) { alert('Lütfen bir şirket seçin!'); return; } startProcess(); window.tourManager.storeTourState(window.currentTours, -1, formData); await checkAndContinueTourProcess(); }); panel.querySelector('#stopInvites').addEventListener('click', stopProcess); }
    async function checkAndContinueTourProcess() { const tourState = window.tourManager.getTourState(); if (!tourState || isProcessStopped()) { if (isProcessStopped()) console.log("İşlem durdurulduğu için devam edilmiyor."); window.tourManager.clearTourState(); return; } const nextIndex = tourState.currentIndex + 1; if (nextIndex >= tourState.tours.length) { alert('Tüm davetler tamamlandı!'); window.tourManager.clearTourState(); return; } const panel = document.querySelector('.invite-panel'); if (panel) { const progressBar = panel.querySelector('#progressBar div'); const progressText = panel.querySelector('#progressText'); panel.querySelector('#progressBar').style.display = 'block'; progressBar.style.width = `${((nextIndex + 1) / tourState.tours.length) * 100}%`; progressText.textContent = `İşlem: ${nextIndex + 1}/${tourState.tours.length}`; panel.querySelector('#tourStatus').textContent = `Sıradaki davet gönderiliyor: ${tourState.tours[nextIndex][2]}`; } window.tourManager.storeTourState(tourState.tours, nextIndex, tourState.formData); await window.tourManager.processTour( tourState.tours[nextIndex], tourState.formData.companyId, tourState.formData.artistCut, tourState.formData.rider ); }
    function addInviteIcon() { const heading = document.querySelector('h1'); if (!heading || !heading.textContent.includes('Sanatçı Çağır')) return; if(document.getElementById('popmundo-araclari-davet-ikonu')) return; const icon = document.createElement('img'); icon.id = 'popmundo-araclari-davet-ikonu'; icon.src = 'https://i.ibb.co/B56cDw2L/star.png'; icon.style.cssText = 'width:20px;height:20px;margin-left:10px;cursor:pointer;vertical-align:middle;'; const panel = createInvitePanel(); icon.addEventListener('click', () => { panel.style.display = panel.style.display === 'none' ? 'block' : 'none'; }); heading.appendChild(icon); heading.parentNode.insertBefore(panel, heading.nextSibling); attachInvitePanelListeners(panel); }
    function init() {
        window.tourManager = new TourManager();
        if (window.location.href.includes('/Company/Locales/')) {
            const ui = createUI();
            if (!ui) return;
            const storage = new CompanyStorage();
            let currentCompanyId = null;
            const loadCompanies = () => { ui.companySelect.innerHTML = '<option value="">Şirket Seçiniz</option>'; storage.getCompanies().forEach(c => ui.companySelect.add(new Option(c.name, c.id))); ui.companySelect.add(new Option("➕ Yeni Şirket", "new_company")); };
            ui.companySelect.addEventListener('change', (e) => { const val = e.target.value; const newCompanyArea = document.getElementById('newCompanyArea'); const showButtons = val && val !== 'new_company'; newCompanyArea.style.display = val === 'new_company' ? 'block' : 'none'; ui.saveVenuesBtn.style.display = showButtons ? 'inline-flex' : 'none'; ui.deleteCompanyBtn.style.display = showButtons ? 'inline-flex' : 'none'; currentCompanyId = showButtons ? parseInt(val) : null; });
            ui.createCompanyBtn.addEventListener('click', () => { const name = ui.companyNameInput.value.trim(); if (name) { const newId = storage.saveCompany(name); loadCompanies(); ui.companySelect.value = newId; ui.companySelect.dispatchEvent(new Event('change')); ui.statusDiv.textContent = '✅ Şirket oluşturuldu'; setTimeout(() => ui.statusDiv.textContent = '', 2000); } });
            ui.deleteCompanyBtn.addEventListener('click', () => { if (currentCompanyId && confirm('Şirketi silmek istediğinizden emin misiniz?')) { storage.deleteCompany(currentCompanyId); loadCompanies(); ui.companySelect.dispatchEvent(new Event('change')); ui.statusDiv.textContent = 'Şirket silindi.'; setTimeout(() => ui.statusDiv.textContent = '', 2000); } });
            ui.saveVenuesBtn.addEventListener('click', async () => { ui.statusDiv.textContent = 'Mekanlar okunuyor...'; const venues = await scrapeVenues(); if (venues.length > 0) { storage.saveVenues(currentCompanyId, venues); ui.statusDiv.textContent = `✅ ${venues.length} mekân kaydedildi.`; } else { ui.statusDiv.textContent = '⚠️ Mekân bulunamadı.'; } setTimeout(() => ui.statusDiv.textContent = '', 2000); });
            loadCompanies();
        }
        if (window.location.href.includes('/Artist/InviteArtist/')) {
            addInviteIcon();
            setTimeout(checkAndContinueTourProcess, 500);
        }
    }
    window.addEventListener('load', init);

})();